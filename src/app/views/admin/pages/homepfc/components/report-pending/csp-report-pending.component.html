<!--
<div class="container-fluid" id="container-wrapper">
    <div class="row d-flex">
        <p>{{registresReports!.length}} élément(s)</p>
        <div class="table-responsive">
        <table class="table table-sm table-bordered">
            <thead class="">
                <tr>
                    <th>#</th>
                    <th>Titre</th>
                    <th>Usagers reçus</th>
                    <th>Usagers satisfaits</th>
                    <th>Statut</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>

                 <tr *ngFor="let rgr of registresReports
                 | paginate: {
                        id:'ngxP2',
                        itemsPerPage: pg2.pageSize,
                        currentPage: pg2.p,
                        totalItems: pg2.total }">
                        <td>
                            <input type="radio" (change)="checkedRegistreReport(rgr)">

                        </td>
                <td>{{rgr.title}} </td>

                <td>{{rgr.customer_recieved}} </td>
                <td>{{rgr.customer_satisfied}} </td>
                <td>

                </td>
                <td>
                    <button class="btn btn-sm btn-primary mx-1" [disabled]="loading2" (click)="openReportShowModal(showReport,rgr)"> <i class="fa fa-eye text-white"></i> </button>
                    <ng-container *ngIf="rgr.status==0">
                        <button class="btn btn-sm btn-warning mx-1" [disabled]="loading2" (click)="openReportEditModal(editReport,rgr)"> <i class="fa fa-edit text-white"></i> </button>
                        <button class="btn btn-sm btn-danger mx-1" [disabled]="loading2" (click)="deleteReport(rgr.id)"> <i class="fa fa-trash text-white"></i> </button>
                    </ng-container>

                      <button class="btn btn-sm btn-success  mx-1" [disabled]="loading2" (click)="transmit(rgr.id)"> <i class="fa fa-arrow-up text-white"></i> </button>
                      <button class="btn btn-sm btn-warning  mx-1" [disabled]="loading2" (click)="openReportEditModal(correctReport,rgr)"> <i class="fa fa-arrow-down text-white"></i> </button>
                     <button class="btn btn-sm btn-info  mx-1" [disabled]="loading2" (click)="getFile(rgr.filename)"> <i class="fa fa-file text-white"></i> </button>
                </td>
                </tr>

            </tbody>
        </table>

        </div>
    <pagination-controls
            id="ngxP2"
            (pageChange)="getPage2($event)"
          [maxSize]="9"
          [directionLinks]="true"
          [autoHide]="true"
          [responsive]="true"
          [previousLabel]="'Précédent'"
          [nextLabel]="'Suivant'"
          [screenReaderPaginationLabel]="'Pagination'"
          [screenReaderPageLabel]="'page'"
          [screenReaderCurrentLabel]="'Vous êtes sur la page'">
         </pagination-controls>
    </div>
</div> -->

<div class="flex flex-col gap-y-8 w-full">
  <div>
    <h2 class="text-3xl font-semibold text-dark-900 mb-2 text-balance">Rapports en attente de validation</h2>
  </div>
  <div class="w-full bg-white rounded-3xl shadow-sm border border-gray-100 p-6 animate-in">
    <div class="flex flex-row justify-between items-center">
      <h3 class="text-base lg:text-lg 2xl:text-xl font-medium text-dark-900 mb-6">
        <p>{{registresReports!.length}} élément(s)</p>
      </h3>
    </div>

    <div class="space-y-4">
      <div class="table-responsive">
        <table class="w-full rounded-t-lg border-separate border-spacing-0">
          <thead class="bg-primary">
            <tr>
              <th class="py-3.5 px-4 text-start text-xs font-semibold text-white border-b border-primary rounded-tl-lg">
                Titre
              </th>
              <th class="py-3.5 px-4 text-start text-xs font-semibold text-white border-b border-primary">
                Usagers reçus</th>
              <th class="py-3.5 px-4 text-start text-xs font-semibold text-white border-b border-primary">
                Usagers satisfaits
              </th>
              <th class="py-3.5 px-4 text-start text-xs font-semibold text-white border-b border-primary">
                Statut
              </th>
              <th class="rounded-tr-lg py-3.5 px-4 text-start text-xs font-semibold text-white border-b border-primary">
                Action

              </th>
            </tr>
          </thead>
          <tbody *ngIf="registresReports.length !== 0">
            <tr *ngFor="let rgr of registresReports
                             | sampleSearch:search_text
                             | paginate: {
                                    id:'ngxP2',
                                    itemsPerPage: pg2.pageSize,
                                    currentPage: pg2.p,
                                    totalItems: pg2.total }">
              <!-- <td>
                <input type="radio" (change)="checkedRegistreReport(rgr)">

              </td> -->
              <td class="py-2.5 px-4 text-xs font-medium border border-gray-200">{{rgr.title}} </td>

              <td class="py-2.5 px-4 text-xs font-medium border border-gray-200">{{rgr.customer_recieved}} </td>
              <td class="py-2.5 px-4 text-xs font-medium border border-gray-200">{{rgr.customer_satisfied}} </td>
              <td class="py-2.5 px-4 text-xs font-medium border border-gray-200">
                <span *ngIf="rgr.status==0">Nouveau</span>
                <span *ngIf="rgr.status==1 && rgr?.transmission.user_down!=user.id">En attente de validation</span>
                <span *ngIf="rgr.status==1 && rgr?.transmission.sens!=1 && rgr?.transmission.user_down==user.id">En
                  attente de correction</span>
                <span *ngIf="rgr.status==2">Validé</span>
                <br>
                <button *ngIf="rgr.status==1 && rgr?.transmission.sens!=1" class="btn btn-sm btn-primary mx-1"
                  [disabled]="loading2" (click)="openReportShowModal(correctShowReport,rgr)"> voir le motif</button>
              </td>
              <td class="py-2.5 px-4 text-xs font-medium text-center border border-gray-200">
                <div class="flex flex-row items-center justify-center gap-3">
                  <button (click)="openReportShowModal(showReport,rgr)" [disabled]="loading2"
                    class="text-primary bg-primary/20 flex items-center justify-center rounded-full size-8">
                    <span class="sr-only">Show</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24">
                      <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2">
                        <path
                          d="M2.062 12.348a1 1 0 0 1 0-.696a10.75 10.75 0 0 1 19.876 0a1 1 0 0 1 0 .696a10.75 10.75 0 0 1-19.876 0" />
                        <circle cx="12" cy="12" r="3" />
                      </g>
                    </svg>
                  </button>
                  <!-- <button class="btn btn-sm btn-primary mx-1" [disabled]="loading2"
                  (click)="openReportShowModal(showReport,rgr)"> <i class="fa fa-eye text-white"></i> </button> -->
                  <ng-container *ngIf="rgr.status===0">
                    <button [disabled]="loading2" (click)="openReportEditModal(editReport,rgr)"
                      class="text-yellow-500 bg-yellow-500/20 flex items-center justify-center rounded-full size-8">
                      <span class="sr-only">Modifier</span>
                      <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24">
                        <path fill="none" stroke="currentColor"
                          d="M4.5 17.207V19a.5.5 0 0 0 .5.5h1.793a.5.5 0 0 0 .353-.146l8.5-8.5l-2.5-2.5l-8.5 8.5a.5.5 0 0 0-.146.353ZM15.09 6.41l2.5 2.5l1.203-1.203a1 1 0 0 0 0-1.414l-1.086-1.086a1 1 0 0 0-1.414 0z" />
                      </svg>
                    </button>
                    <button [disabled]="loading2" (click)="deleteReport(rgr.id)"
                      class="text-red-500 bg-red-500/20 flex items-center justify-center rounded-full size-8">
                      <span class="sr-only">Delete</span>
                      <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24">
                        <path fill="currentColor"
                          d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM9 9h6c.55 0 1 .45 1 1v8c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-8c0-.55.45-1 1-1m6.5-5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z" />
                      </svg>
                    </button>
                  </ng-container>

                  <button [disabled]="loading2" (click)="transmit(rgr.id)"
                    class="text-green-light bg-green-light/20 flex items-center justify-center rounded-full size-8">
                    <span class="sr-only">Transmettre</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24">
                      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2"
                        d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11zm7.318-19.539l-10.94 10.939" />
                    </svg>
                  </button>
                  <button [disabled]="loading2" (click)="getFile(rgr.filename)"
                    class="text-sky-500 bg-sky-500/20 flex items-center justify-center rounded-full size-8">
                    <span class="sr-only">Document</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24">
                      <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2">
                        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
                        <path d="M14 2v4a2 2 0 0 0 2 2h4M10 9H8m8 4H8m8 4H8" />
                      </g>
                    </svg>
                  </button>

                  <button [disabled]="loading2" (click)="openReportEditModal(correctReport,rgr)"
                    class="text-yellow-500 bg-yellow-500/20 flex items-center justify-center rounded-full size-8">
                    <span class="sr-only">Modifier</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24">
                      <path fill="none" stroke="currentColor"
                        d="M4.5 17.207V19a.5.5 0 0 0 .5.5h1.793a.5.5 0 0 0 .353-.146l8.5-8.5l-2.5-2.5l-8.5 8.5a.5.5 0 0 0-.146.353ZM15.09 6.41l2.5 2.5l1.203-1.203a1 1 0 0 0 0-1.414l-1.086-1.086a1 1 0 0 0-1.414 0z" />
                    </svg>
                  </button>
                </div>

              </td>
            </tr>

          </tbody>
          <tbody *ngIf="registresReports.length === 0" class="divide-y divide-gray-300 bg-white">
            <tr>
              <td colspan="10" class="p-4 w-full whitespace-nowrap">
                <div class="flex justify-center w-full items-center text-gray-800 text-center">
                  <div *ngIf="!loading2"
                    class="flex flex-col justify-center w-full items-center text-gray-800 text-center space-y-3"><svg
                      xmlns="http://www.w3.org/2000/svg" class="size-12 text-primary" viewBox="0 0 24 24">
                      <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="1.5" color="currentColor">
                        <path
                          d="M18 15v7m3.5-3.5h-7M7 16h4m-4-5h8M6.5 3.5c-1.556.047-2.483.22-3.125.862c-.879.88-.879 2.295-.879 5.126v6.506c0 2.832 0 4.247.879 5.127C4.253 22 5.668 22 8.496 22H11.5m3.992-18.5c1.556.047 2.484.22 3.125.862c.88.88.88 2.295.88 5.126V12" />
                        <path
                          d="M6.496 3.75c0-.966.784-1.75 1.75-1.75h5.5a1.75 1.75 0 1 1 0 3.5h-5.5a1.75 1.75 0 0 1-1.75-1.75" />
                      </g>
                    </svg>
                    <p class="font-avenirMedium text-sm">Aucune donnée</p>

                  </div>
                  <div *ngIf="loading2"
                    class="flex flex-col justify-center w-full items-center text-gray-800 text-center space-y-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="size-12 text-primary" viewBox="0 0 24 24">
                      <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="1.2">
                        <path stroke-dasharray="16" stroke-dashoffset="16" d="M12 3c4.97 0 9 4.03 9 9">
                          <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="16;0" />
                          <animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate"
                            values="0 12 12;360 12 12" />
                        </path>
                        <path stroke-dasharray="64" stroke-dashoffset="64" stroke-opacity="0.2"
                          d="M12 3c4.97 0 9 4.03 9 9c0 4.97 -4.03 9 -9 9c-4.97 0 -9 -4.03 -9 -9c0 -4.97 4.03 -9 9 -9Z">
                          <animate fill="freeze" attributeName="stroke-dashoffset" dur="1.2s" values="64;0" />
                        </path>
                      </g>
                    </svg>
                    <p class="font-avenirMedium text-sm">Chargement en cours ...</p>

                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

      </div>
      <pagination-controls id="ngxP2" (pageChange)="getPage2($event)" [maxSize]="9" [directionLinks]="true"
        [autoHide]="true" [responsive]="true" [previousLabel]="'Précédent'" [nextLabel]="'Suivant'"
        [screenReaderPaginationLabel]="'Pagination'" [screenReaderPageLabel]="'page'"
        [screenReaderCurrentLabel]="'Vous êtes sur la page'">
      </pagination-controls>
    </div>
  </div>
</div>



<ng-template #addReport let-modal>
  <form #addReportForm="ngForm" (ngSubmit)="storeReport(addReportForm.value)" class="form-horizontal " novalidate="">

    <div class="modal-header  d-flex justify-content-between align-items-center bg-secondary">
      <h5 class="modal-title text-white" id="modal-basic-title">Générer un rapport</h5>
      <button type="button" class="close text-white" aria-label="Close" (click)="modal.dismiss('Cross click')">
        X
      </button>
    </div>
    <div class="modal-body">
      <div style="color:red">{{errormessage}}</div>

      <div class="row">
        <div class="col-12 mb-3">
          <div class="form-group">
            <label for="">Mois</label>
            <select name="month" ngModel class="form-control">
              <option value="01">Janvier</option>
              <option value="02">Février</option>
              <option value="03">Mars</option>
              <option value="04">Avril</option>
              <option value="05">Mai</option>
              <option value="06">Juin</option>
              <option value="07">Juillet</option>
              <option value="08">Août</option>
              <option value="09">Septembre</option>
              <option value="10">Octobre</option>
              <option value="11">Novembre</option>
              <option value="12">Décembre</option>
            </select>
          </div>
        </div>
        <div class="col-12 mb-3">
          <div class="form-group">
            <label for="">Synthèse Analytique</label>
            <textarea name="summary" ngModel class="form-control"></textarea>
          </div>
        </div>

      </div>
    </div>
    <div class="modal-footer">
      <button type="submit" [disabled]="loading2" class="btn btn-secondary mx-1"><i
          class="fas fa-save"></i>&nbsp;Générer</button>
    </div>
  </form>
</ng-template>
<ng-template #editReport let-modal>
  <form #editReportForm="ngForm" (ngSubmit)="updateReport(editReportForm.value)" class="form-horizontal " novalidate="">

    <div class="modal-header  d-flex justify-content-between align-items-center bg-secondary">
      <h5 class="modal-title text-white" id="modal-basic-title">Mettre à jour le rapport</h5>
      <button type="button" class="close text-white" aria-label="Close" (click)="modal.dismiss('Cross click')">
        X
      </button>
    </div>
    <div class="modal-body">
      <div style="color:red">{{errormessage}}</div>

      <div class="row">

        <div class="col-12 mb-3">
          <div class="form-group">
            <label for="">Synthèse Analytique</label>
            <textarea name="summary" [(ngModel)]="selected_data.summary" class="form-control"></textarea>
          </div>
        </div>

      </div>
    </div>
    <div class="modal-footer">
      <button type="submit" [disabled]="loading2" class="btn btn-secondary mx-1"><i
          class="fas fa-save"></i>&nbsp;Modifier</button>
    </div>
  </form>
</ng-template>
<ng-template #correctReport let-modal>
  <form #correctForm="ngForm" (ngSubmit)="correct(correctForm.value)" class="form-horizontal " novalidate="">

    <div class="modal-header  d-flex justify-content-between align-items-center bg-secondary">
      <h5 class="modal-title text-white" id="modal-basic-title">Retourner pour correction</h5>
      <button type="button" class="close text-white" aria-label="Close" (click)="modal.dismiss('Cross click')">
        X
      </button>
    </div>
    <div class="modal-body">
      <div style="color:red">{{errormessage}}</div>

      <div class="row">

        <div class="col-12 mb-3">
          <div class="form-group">
            <label for="">Instruction</label>
            <textarea name="instruction" ngModel class="form-control"></textarea>
          </div>
        </div>
        <div class="col-12 mb-3">
          <div class="form-group">
            <label for="">Délai</label>
            <input type="datetime-local" name="delay" ngModel class="form-control">
          </div>
        </div>

      </div>
    </div>
    <div class="modal-footer">
      <button type="submit" [disabled]="loading2" class="btn btn-secondary mx-1"><i
          class="fas fa-save"></i>&nbsp;Retourner pour correction</button>
    </div>
  </form>
</ng-template>
<ng-template #showReport let-modal>

  <div class="modal-header  d-flex justify-content-between align-items-center bg-secondary">
    <h5 class="modal-title text-white" id="modal-basic-title">Détails rapport</h5>
    <button type="button" class="close text-white" aria-label="Close" (click)="modal.dismiss('Cross click')">
      X
    </button>
  </div>
  <div class="modal-body">
    <div style="color:red">{{errormessage}}</div>

    <div class="row">

      <div class="col-12 mb-3">
        <div class="form-group">
          <label for=""><strong>Usagers reçus</strong></label>
          <p>{{selected_data.customer_recieved}}</p>
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="form-group">
          <label for=""><strong>Usagers satisfaits</strong></label>
          <p>{{selected_data.customer_satisfied}}</p>
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="form-group">
          <label for=""><strong>Principales raisons d'insatisfaction</strong></label>
          <p>{{selected_data.unsatified_reason}}</p>
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="form-group">
          <label for=""><strong>Problèmes / difficultés rencontrées par le Point Focal </strong></label>
          <p>{{selected_data.difficult}}</p>
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="form-group">
          <label for=""><strong>Approches de solutions préconisées par le Point Focal</strong> </label>
          {{selected_data.solution}}
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="form-group">
          <label for=""><strong>Observations</strong></label>
          {{selected_data.observation}}
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="form-group">
          <label for=""><strong>Synthèse analytique</strong></label>
          {{selected_data.summary}}
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #contentPDF let-offcanvas>
  <div class="offcanvas-header">

    <h4 class="offcanvas-title">Visualiseur de fichier</h4>
    <button id="closePDFBtn" type="button" class="btn-close" aria-label="Close"
      (click)="offcanvas.dismiss('Cross click')"></button>
  </div>
  <div class="offcanvas-body">
    <ngx-extended-pdf-viewer [src]="pdfSrc" style="width: 100%; height: 100%"></ngx-extended-pdf-viewer>
  </div>
</ng-template>
<ng-template #correctShowReport let-modal>

  <div class="modal-header  d-flex justify-content-between align-items-center bg-secondary">
    <h5 class="modal-title text-white" id="modal-basic-title">Détails instruction</h5>
    <button type="button" class="close text-white" aria-label="Close" (click)="modal.dismiss('Cross click')">
      X
    </button>
  </div>
  <div class="modal-body">

    <div class="row">

      <div class="col-12 mb-3">
        <div class="form-group">
          <label for="">Instruction</label>
          <p>{{selected_data.transmission?.instruction}}</p>
        </div>
      </div>
      <div class="col-12 mb-3">
        <div class="form-group">
          <label for="">Delai</label>
          <p>{{selected_data.transmission?.delay | date:"dd-MM-yyyy"}}</p>
        </div>
      </div>

    </div>
  </div>
</ng-template>
