<!-- <mat-toolbar color="">
  <button mat-icon-button (click)="toggleMenu()">
    <mat-icon>menu</mat-icon>
  </button>
  <span class="fw-bold">{{title}}</span>
  <div class="">
    <button mat-button [matMenuTriggerFor]="userMenu">
      <img [src]="'assets/user.jpg'" class="avatar" alt="avatar utilisateur">
      <span class="username text-white">{{ userConnected?.name ?? "Non défini"}}</span>
      <mat-icon>arrow_drop_down</mat-icon>
    </button>

    <mat-menu #userMenu="matMenu">
      <div class="menu-header">
        <img [src]="'assets/user.jpg'" class="avatar" alt="avatar">
        <div>
          <strong>{{ userConnected?.name }}</strong>
          <p>{{ userConnected?.email }}</p>
        </div>
      </div>
      <button mat-menu-item (click)="openAddModal(profil)">
        <mat-icon>edit</mat-icon>
        <span>Modifier le profil</span>
      </button>
      <mat-divider></mat-divider>
      <button class="btn btn-sm btn-danger" (click)="logout()">Déconnexion</button>
    </mat-menu>
  </div>
</mat-toolbar> -->
<div class="min-h-screen bg-gray-50">
  <header class="bg-primary-dark text-white shadow-xl border-b border-primary/30">
    <div class="flex items-center justify-between px-8 py-2">
      <div class="flex items-center gap-x-6">
        <button (click)="menuOpen = !menuOpen" class="p-2 rounded-xl hover:bg-dark-700/50 transition-all duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600!" *ngIf="!menuOpen" viewBox="0 0 24 24">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 12h16M4 18h16M4 6h16" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600!" *ngIf="menuOpen" viewBox="0 0 24 24">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M5 12h14m-7-7v14" />
          </svg>
        </button>
        <h1 class="text-xl font-light tracking-wide transition-opacity duration-300">
          {{title}}
        </h1>
      </div>

      <div class="flex items-center gap-x-6">

        <button (click)="op.toggle($event)"
          class="flex items-center gap-x-4 bg-gradient-to-r from-green-light from-0%  to-primary rounded-2xl p-4  transition-all duration-200 cursor-pointer">
          <div class="w-9 h-9 bg-primary-dark/50 rounded-xl flex items-center justify-center">
            <lucide-icon [img]="userIcon" size="20" class="text-white"></lucide-icon>
          </div>
          <div class="hidden md:block">
            <!-- <div class="font-medium text-sm">{{userConnected?.name? userConnected?.name:userConnected?.agent_user?.nomprenoms}}</div> -->
            <div class="font-medium text-sm">{{ userConnected?.email }}</div>
            <div class="text-dark-400 text-xs">{{(userConnected?.name && userConnected?.name !== ' ') ? userConnected?.name : userConnected?.agent_user?.nomprenoms}}</div>
          </div>
          <lucide-icon [img]="chevronDownIcon" size="16" class="text-dark-400"></lucide-icon>
        </button>
        <p-overlayPanel #op>
          <div class="flex flex-col gap-0.5 w-full max-w-[25rem] bg-white rounded-xl divide divide-gray-500">
            <div class="flex items-center gap-x-4  rounded-2xl transition-all duration-200 cursor-pointer">
              <div class="w-9 h-9 bg-primary-dark/70 rounded-xl flex items-center justify-center">
                <lucide-icon [img]="userIcon" size="20" class="text-white"></lucide-icon>
              </div>
              <div class="hidden md:block">
                <div class="font-semibold text-sm">{{ userConnected?.email }}</div>
                <div class="text-green-light text-xs">{{(userConnected?.name && userConnected?.name !== ' ')? userConnected?.name:userConnected?.agent_user?.nomprenoms}}</div>
              </div>
            </div>
            <hr>
            <div class="flex flex-col w-full pb-3">
              <button (click)="openAddModal()"
                class="flex flex-row gap-x-2 py-2 px-3 w-full justify-start items-center text-gray-400 hover:text-primary hover:bg-primary/20 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24">
                  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                    <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                    <path
                      d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z" />
                  </g>
                </svg>
                <span>Modifier</span>
              </button>
              <button (click)="logout()"
                class="flex flex-row gap-x-2 py-2 px-3 w-full justify-start items-center text-gray-400 hover:text-primary hover:bg-primary/20 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24">
                  <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" d="m16 17l5-5l-5-5m5 5H9m0 9H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                </svg>
                <span>Déconnexion</span>
              </button>
            </div>
          </div>
        </p-overlayPanel>

      </div>
    </div>
  </header>
  <div class="flex">
    <aside
      [class]="'bg-white shadow-sm h-screen left-0 top-0 pt-0 z-40 border-r border-gray-100 transition-all duration-300 animate-in ' + (menuOpen ? 'w-20' : 'w-72')">
      <nav [class]="'py-8 transition-all duration-300 ' + (menuOpen ? 'px-3' : 'px-6')">

        <ul class="gap-y-2">
          <li *ngFor="let item of menuItems" [hidden]="(!canUseWhatsapp && item.external) || (item.espace!==null && item.espace!==espace)">
            <a [routerLinkActiveOptions]="{exact:true}" [routerLink]="[item.id]"
              routerLinkActive="bg-green-light hover:bg-bg-green-light/70 text-white! shadow-lg shadow-green-light/20"
              [class]="getButtonClasses(item)" [title]="menuOpen ? item.label : undefined">

              <lucide-icon [img]="item.icon" size="20"
                [ngClass]="{'text-white':activeSection === item.id,'text-gray-400 group-hover:text-green-light':activeSection !== item.id}">
              </lucide-icon>

              <ng-container *ngIf="!menuOpen">
                <span class="font-medium">{{ item.label }}</span>
              </ng-container>

              <!-- Tooltip pour mode menuOpen -->
              <div *ngIf="menuOpen"
                class="absolute left-full ml-3 px-3 py-2 bg-dark-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50 scale-in">
                {{ item.label }}
                <div
                  class="absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-dark-900 rotate-45">
                </div>
              </div>
            </a>
          </li>
          <!-- <li>
            <a [routerLinkActiveOptions]="{exact:true}" [routerLink]="[item.id]"
              routerLinkActive="bg-green-light hover:bg-bg-green-light/70 text-white! shadow-lg shadow-green-light/20"
              [class]="getButtonClasses(item)" >

              <lucide-icon [img]="externalLinkIcon" size="20"
                class="text-white  group-hover:text-green-light">
              </lucide-icon>

              <ng-container *ngIf="!menuOpen">
                <span class="font-medium">{{ 'Site Web' }}</span>
              </ng-container>

              <div *ngIf="menuOpen"
                class="absolute left-full ml-3 px-3 py-2 bg-dark-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50 scale-in">
                {{ 'Site Web' }}
                <div
                  class="absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-dark-900 rotate-45">
                </div>
              </div>
            </a>
          </li>  -->
        </ul>
      </nav>
    </aside>
    <main [class]="'flex-1 p-10 pt-8 transition-all duration-300 w-auto' + (menuOpen ? 'ml-20' : 'ml-72')">
      <router-outlet></router-outlet>
    </main>
  </div>

  <!-- <mat-sidenav-container class="">
  <mat-sidenav #sidenav mode="side" [(opened)]="menuOpen" class="bg-white">
    <ng-container *ngIf="espace==0">
      <mat-nav-list>
        <a mat-list-item routerLink="/admin/home">Accueil</a>
      </mat-nav-list>
    </ng-container>
    <ng-container *ngIf="espace==1">
      <mat-nav-list>
        <a mat-list-item routerLink="/admin/homepfc">Accueil</a>
      </mat-nav-list>
      <mat-nav-list>
        <a mat-list-item routerLink="/admin/homepfc/pfc-mataccueil">Suivi des préoccupations</a>
      </mat-nav-list>
      <mat-nav-list>
        <a mat-list-item routerLink="/admin/homepfc/pfc-registre">Régistre des visiteurs</a>
      </mat-nav-list>
      <mat-nav-list *ngIf="canUseWhatsapp">
        <a mat-list-item routerLink="/admin/homepfc/pfc-whatsapp">WhatsApp</a>
      </mat-nav-list>
      <mat-nav-list>
        <a mat-list-item routerLink="/admin/homepfc/rapports-requetes">Rapport des préoccupations</a>
      </mat-nav-list>
      <mat-nav-list>
        <a mat-list-item routerLink="/admin/homepfc/performances">Performances des centres</a>
      </mat-nav-list>
    </ng-container>
    <ng-container *ngIf="espace==2">

    </ng-container>


    <hr>
    <mat-nav-list>
      <a mat-list-item routerLink="/">Aller au site</a>
    </mat-nav-list>
  </mat-sidenav>
  <mat-sidenav-content class="p-3">
    <router-outlet></router-outlet>
  </mat-sidenav-content>
</mat-sidenav-container> -->

</div>


<p-dialog #profil [modal]="true" [(visible)]="open">
  <ng-template pTemplate="headless">
    <form #frmusager="ngForm" (ngSubmit)="saveUsager(frmusager.value)" class="m-0 p-0 b-white" novalidate="">
      <div class="bg-primary flex flex-row justify-between items-center p-4">
        <h5 class="text-lg font-bold text-white" id="modal-basic-title">Mon profil</h5>
        <button type="button" class="text-white" aria-label="Close" (click)="close()">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-8" viewBox="0 0 36 36">
            <path fill="currentColor"
              d="m19.41 18l8.29-8.29a1 1 0 0 0-1.41-1.41L18 16.59l-8.29-8.3a1 1 0 0 0-1.42 1.42l8.3 8.29l-8.3 8.29A1 1 0 1 0 9.7 27.7l8.3-8.29l8.29 8.29a1 1 0 0 0 1.41-1.41Z"
              class="clr-i-outline clr-i-outline-path-1" />
            <path fill="none" d="M0 0h36v36H0z" />
          </svg>
        </button>
      </div>
      <div class="bg-white p-4 flex flex-col gap-3 w-full">
        <div style="color: red;">{{errormessage}}</div>
        <div class="flex flex-col gap-1.5 w-full">
          <label for="firstname" class=""> Prénoms * </label>
          <input type="text" class="p-2 border border-gray-300 rounded-lg w-full has-error" id="firstname" name="firstname"
            value="{{user?.firstname}}" [(ngModel)]="user.firstname" required>
        </div>
        <div class="flex flex-col gap-1.5 w-full">
          <label for="lastname" class=""> Nom * </label>
          <input type="text" class="p-2 border border-gray-300 rounded-lg w-full has-error" id="lastname" name="lastname"
            value="{{user?.lastname}}" [(ngModel)]="user.lastname" required>
        </div>

        <div class="flex flex-col gap-1.5 w-full">
          <label for="email" class=""> Email * </label>
          <input type="email" class="p-2 border border-gray-300 rounded-lg w-full has-error" id="email" name="email"
            value="{{user?.email}}" [(ngModel)]="user.email" required>
        </div>

        <div class="flex flex-col gap-1.5 w-full">
          <label for="tel2" class="col-sm-3 control-label"> Téléphone *</label>
          <input type="text" numbers-only="numbers-only" class="p-2 border border-gray-300 rounded-lg w-full has-error"
            id="tel2" name="tel" value="{{user?.phone}}" [(ngModel)]="user.phone" required>
        </div>
      </div>
      <div class="flex flex-col justify-center items-center mb-4">
        <button type="submit" class="bg-primary px-3 py-2 rounded-lg text-white flex flex-row gap-2"
          [disabled]="frmusager.invalid">
          <svg *ngIf="!loading" xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
              <path
                d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" />
              <path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7M7 3v4a1 1 0 0 0 1 1h7" />
            </g>
          </svg>
          <svg *ngIf="loading" xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="16" stroke-dashoffset="16" d="M12 3c4.97 0 9 4.03 9 9"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="16;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path><path stroke-dasharray="64" stroke-dashoffset="64" stroke-opacity="0.3" d="M12 3c4.97 0 9 4.03 9 9c0 4.97 -4.03 9 -9 9c-4.97 0 -9 -4.03 -9 -9c0 -4.97 4.03 -9 9 -9Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.2s" values="64;0"/></path></g></svg>
          &nbsp;
          <span>Enregistrer</span></button>
      </div>
    </form>
  </ng-template>
</p-dialog>
